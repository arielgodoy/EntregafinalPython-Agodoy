AUDITORÃA GLOBAL DE VIEWS - PROYECTO ENTREGAFINALPY THON-AGODOY
Fecha: 2025-02-14
Alcance: 11 aplicaciones, 120+ vistas/endpoints
Criterios: CBV+Mixin oficial, Multiempresa, Vista.nombre + prefijo app, AutenticaciÃ³n + Permisos granulares, AJAX pattern, EliminaciÃ³n modal



APP: biblioteca
ESTADO: 6 INCUMPLIMIENTOS (Alto riesgo)

âœ… CUMPLEN ESTÃNDAR:
CrearPropiedadView, DetallePropiedadView, ModificarPropiedadView, EliminarPropiedadView
CrearPropietarioView, DetallePropietarioView, ModificarPropietarioView, EliminarPropietarioView
CrearTipoDocumentoView, ListarTiposDocumentosView, ModificarTipoDocumentoView, EliminarTipoDocumentoView
EliminarDocumentoView

âŒ NO CUMPLEN ESTÃNDAR:

1. VerificarPermisoMixin (CBV, lÃ­nea 41-57)
   [LOCAL_MIXIN]
   MOTIVO: Define su propio mixin en lugar de importar la versiÃ³n oficial de access_control.views
   RIESGO: Bajo (duplicaciÃ³n innecesaria pero funcional)
   PROPUESTA: Remover mixin local. Cambiar imports para usar:
      from access_control.views import VerificarPermisoMixin
      Luego heredar de Ã©l en vistas que lo usen.

2. ModalesEjemploView (CBV, lÃ­nea 106)
   [NO_MIXIN]
   MOTIVO: Solo usa LoginRequiredMixin, falta VerificarPermisoMixin con vista_nombre y permiso_requerido
   RIESGO: Bajo (vista de ejemplo, no datos reales)
   PROPUESTA: Agregar VerificarPermisoMixin si es pÃºblica, o marcar como @staff_only si es temporal.

3. respaldo_biblioteca_zip (FBV, lÃ­nea 111)
   [NO_MIXIN]
   MOTIVO: Solo @login_required, sin @verificar_permiso. Genera ZIP de todos los archivos sin validar permisos.
   RIESGO: CRÃTICO - permite acceso a todos los archivos sin permiso granular
   PROPUESTA: Convertir a CBV o agregar decorator @verificar_permiso('Biblioteca - Respaldo', 'descargar').
   Vista.nombre sugerido: "Biblioteca - Descargar Respaldo ZIP"

4. descargar_documentos_propiedad_zip (FBV, lÃ­nea 132)
   [NO_MIXIN]
   MOTIVO: Solo @login_required, sin validaciÃ³n de permisos. Descarga ZIP scoped a propiedad pero sin permisos granulares.
   RIESGO: ALTO - acceso a documentos sin control granular de permisos
   PROPUESTA: Convertir a CBV o agregar @verificar_permiso('Biblioteca - Descargar Documentos', 'descargar').
   Validar que propiedad pertenece a empresa_activa en sesiÃ³n.

5. CrearPropietarioModalView (CBV, lÃ­nea 82)
   [BAD_VISTA_NOMBRE]
   MOTIVO: vista_nombre="Maestro Propietarios Modal" no tiene formato "<APP> - <nombre>", deberÃ­a ser "Biblioteca - Maestro Propietarios"
   RIESGO: Bajo (naming inconsistency, funcional)
   PROPUESTA: Cambiar vista_nombre a "Biblioteca - Maestro Propietarios Modal" para consistencia.

6. CrearDocumentoView (CBV, lÃ­nea 394)
   [BAD_VISTA_NOMBRE]
   MOTIVO: vista_nombre="Maestro Propiedades" es incorrecto. DeberÃ­a ser "Biblioteca - Maestro Documentos" o "Biblioteca - Crear Documento"
   RIESGO: Bajo (naming error pero funcional)
   PROPUESTA: Cambiar vista_nombre a "Biblioteca - Crear Documento"

7. ListadoDocumentosView (CBV, lÃ­nea 419)
   [BAD_VISTA_NOMBRE]
   MOTIVO: No tiene vista_nombre visible. Si lo tiene, verificar formato "<APP> - "
   RIESGO: Bajo (si falta, actualizar. Si existe pero mal, actualizar.)
   PROPUESTA: Asegurar vista_nombre="Biblioteca - Listado Documentos"

8. enviar_enlace_documento (FBV, lÃ­nea 438)
   [NO_MIXIN]
   MOTIVO: @login_required pero sin @verificar_permiso. Endpoint que envÃ­a enlaces sin validar permisos granulares.
   RIESGO: ALTO - puede enviarse enlaces sin control de permisos
   PROPUESTA: Agregar @verificar_permiso('Biblioteca - Enviar Enlace Documento', 'comunicar')
   O convertir a CBV con VerificarPermisoMixin.

OBSERVACIÃ“N GENERAL biblioteca: Las vistas CBV sÃ­ heredan VerificarPermisoMixin oficial, pero hay mixin local que debe ser removido. Las FBVs de descarga y envÃ­o necesitan permisos granulares.



APP: acounts
ESTADO: 7 INCUMPLIMIENTOS (Riesgo variable)

âœ… CUMPLEN ESTÃNDAR: ninguna (app de autenticaciÃ³n/gestiÃ³n de usuarios, no requiere granularidad tÃ­pica)

âŒ NO CUMPLEN ESTÃNDAR:

1. crear_usuario_admin (FBV, lÃ­nea 18)
   [NO_MIXIN]
   MOTIVO: Solo @user_passes_test(lambda) sin VerificarPermisoMixin. Sin vista_nombre ni permiso_requerido granular.
   RIESGO: ÃLTO - gestiÃ³n de usuarios crÃ­tica sin trail de permisos en vista_nombre
   PROPUESTA: Convertir a CBV o agregar @verificar_permiso('Acounts - Crear Usuario Admin', 'crear')
   + Vista.nombre="Acounts - Crear Usuario Admin"

2. editar_perfil (FBV, lÃ­nea 31)
   [NO_MIXIN]
   MOTIVO: Solo @login_required. EdiciÃ³n de perfil personal sin validaciÃ³n de vista_nombre/permiso_requerido.
   RIESGO: Bajo (solo perfil propio tÃ­picamente, pero sin auditabilidad de permiso)
   PROPUESTA: Agregar @verificar_permiso('Acounts - Editar Perfil', 'modificar')
   O convertir a CBV.

3. login_view (FBV, lÃ­nea 53)
   [NO_LOGIN_GUARD]
   MOTIVO: Sin @login_required (correcto para login, pero verificar si es accesible pÃºblicamente)
   RIESGO: Bajo (esperado que sea pÃºblico)
   PROPUESTA: Sin cambio necesario.

4. logout_view (FBV, lÃ­nea 93)
   [NO_LOGIN_GUARD]
   MOTIVO: Sin @login_required (tÃ­picamente pÃºblico)
   RIESGO: Bajo (esperado)
   PROPUESTA: Sin cambio necesario.

5. registro_usuario (FBV, lÃ­nea 100)
   [NO_LOGIN_GUARD]
   MOTIVO: Sin @login_required (pÃºblico para auto-registro)
   RIESGO: Bajo (esperado si es registro abierto)
   PROPUESTA: Sin cambio necesario si es registro abierto. Si debe ser controlado, agregar @verificar_permiso.

6. subeAvatar (FBV, lÃ­nea 115)
   [NO_MIXIN]
   MOTIVO: Solo @login_required. Sin validaciÃ³n granular de permisos para upload de avatar.
   RIESGO: Bajo (upload personal de avatar, tÃ­picamente sin restricciÃ³n por usuario)
   PROPUESTA: Agregar @verificar_permiso('Acounts - Subir Avatar', 'modificar') para auditabilidad.

7. cambiar_password (FBV, lÃ­nea 129)
   [NO_MIXIN]
   MOTIVO: Solo @login_required. Cambio de contraseÃ±a sin @verificar_permiso.
   RIESGO: Bajo (cambio personal, pero sin auditabilidad)
   PROPUESTA: Agregar @verificar_permiso('Acounts - Cambiar Password', 'modificar')

OBSERVACIÃ“N GENERAL acounts: App mayormente de autenticaciÃ³n. Las vistas que SÃ son operacionales (crear_usuario_admin, editar_perfil) deberÃ­an tener @verificar_permiso para auditabilidad.



APP: chat
ESTADO: 0 INCUMPLIMIENTOS âœ… (CUMPLE COMPLETAMENTE)

âœ… CUMPLEN ESTÃNDAR:
ChatInboxView, ChatCentroMensajesView, ListaConversacionesView, CrearConversacionView
EnviarMensajeView, DetalleConversacionView, EliminarConversacionView

OBSERVACIÃ“N: Todas las vistas usan VerificarPermisoMixin con vista_nombre descriptivo y permiso_requerido correcto.
chat es un MODELO A SEGUIR para otras apps.



APP: api
ESTADO: 3 INCUMPLIMIENTOS (Alto riesgo)

âœ… CUMPLEN ESTÃNDAR:
PropietarioViewSet (tiene permission_classes = [IsAuthenticated])

âŒ NO CUMPLEN ESTÃNDAR:

1. TrabajadoresViewSet (ViewSet, lÃ­nea 49-89)
   [NO_MIXIN] [NO_LOGIN_GUARD]
   MOTIVO: No tiene permission_classes definido. Acceso directo sin autenticaciÃ³n.
   RIESGO: CRÃTICO - endpoint pÃºblico que expone datos de trabajadores (rut, nombre)
   PROPUESTA: Agregar permission_classes = [IsAuthenticated]
   + Implementar empresa_id scoping en sql_sistema() basado en self.request.session

2. MaestroempresasMRO (ViewSet lÃ­nea 87-120)
   [NO_MIXIN] [NO_LOGIN_GUARD]
   MOTIVO: No tiene permission_classes. Acceso directo sin autenticaciÃ³n.
   RIESGO: CRÃTICO - endpoint pÃºblico que podrÃ­a exponer datos maestros
   PROPUESTA: Agregar permission_classes = [IsAuthenticated]
   + Validar empresa_id en sesiÃ³n

3. invite_user (FBV, lÃ­nea 136-160)
   [NO_MIXIN] [NO_LOGIN_GUARD]
   MOTIVO: @require_POST sin @login_required ni VerificarPermisoMixin. Endpoint AJAX de invitaciÃ³n sin autenticaciÃ³n.
   RIESGO: CRÃTICO - permite invitar usuarios sin estar autenticado
   PROPUESTA: Agregar @login_required
   + Agregar @verificar_permiso('API - Invitar Usuario', 'crear') O mover lÃ³gica a invite handler en access_control

OBSERVACIÃ“N GENERAL api: ViewSets crÃ­ticos sin autenticaciÃ³n. Alto riesgo de exposiciÃ³n de datos.



APP: access_control
ESTADO: 3 INCUMPLIMIENTOS (Riesgo bajo: admin-only)

âœ… CUMPLEN ESTÃNDAR:
PermisosFiltradosView, CopyPermisosView, VistaListaView, VistaCrearView, VistaEditarView, VistaEliminarView
PermisoListaView, EmpresaListaView, EmpresaCrearView, EmpresaEditarView, EmpresaEliminarView
SystemConfigUpdateView, EmailAccountListView, EmailAccountCreateView, EmailAccountUpdateView
CompanyConfigListView, CompanyConfigUpdateView, SystemEmailTestOutgoingView, SystemEmailSendTestView
UsuariosListaView, InvitacionesListView, InvitacionEliminarView, UsuariosPorEmpresasJsonView
BaseUsuarioInviteView, UsuarioCrearView, UsuarioInvitarView, UsuarioEditarView, UsuarioEliminarView
seleccionar_empresa

âŒ NO CUMPLEN ESTÃNDAR:

1. VerificarPermisoMixin (CBV, lÃ­nea 57-95)
   [LOCAL_MIXIN]
   MOTIVO: Define su propio mixin local en lugar de importar la Ãºnica versiÃ³n oficial
   RIESGO: Bajo (IMPORTANTE: Esta es la versiÃ³n OFICIAL. Debe existir aquÃ­. No cambiar.)
   PROPUESTA: Sin cambio. Esta es la versiÃ³n canÃ³nica que otras apps deben importar.

2. PermisoCrearView (CBV, lÃ­nea 298)
   [NO_MIXIN]
   MOTIVO: Solo LoginRequiredMixin. Falta VerificarPermisoMixin con vista_nombre y permiso_requerido.
   RIESGO: Bajo (admin-only tÃ­picamente, pero deberÃ­a tener permisos granulares)
   PROPUESTA: Agregar VerificarPermisoMixin + vista_nombre="Access Control - Crear Permiso" + permiso_requerido="crear"

3. PermisoEditarView (CBV, lÃ­nea 306)
   [NO_MIXIN]
   MOTIVO: Solo LoginRequiredMixin. Falta VerificarPermisoMixin.
   RIESGO: Bajo (admin-only)
   PROPUESTA: Agregar VerificarPermisoMixin + vista_nombre="Access Control - Editar Permiso" + permiso_requerido="modificar"

4. PermisoEliminarView (CBV, lÃ­nea 314)
   [NO_MIXIN]
   MOTIVO: Solo LoginRequiredMixin. Falta VerificarPermisoMixin.
   RIESGO: Bajo (admin-only)
   PROPUESTA: Agregar VerificarPermisoMixin + vista_nombre="Access Control - Eliminar Permiso" + permiso_requerido="eliminar"

5. toggle_permiso (FBV, lÃ­nea 187)
   [NO_MIXIN] [NO_LOGIN_GUARD]
   MOTIVO: @csrf_exempt sin @login_required ni VerificarPermisoMixin. Endpoint AJAX de toggle sin validaciÃ³n.
   RIESGO: ALTO - puede togglear permisos sin estar autenticado
   PROPUESTA: Agregar @login_required + @verificar_permiso('Access Control - Toggle Permiso', 'modificar')

6. solicitar_acceso (FBV, lÃ­nea 828)
   [NO_MIXIN]
   MOTIVO: @login_required @require_POST sin VerificarPermisoMixin. Sin vista_nombre granular, aunque tiene lÃ³gica.
   RIESGO: Bajo (permite cualquier usuario solicitar acceso, lÃ³gica interna valida)
   PROPUESTA: Agregar @verificar_permiso('Access Control - Solicitar Acceso', 'crear') para auditabilidad

7. grant_access_request (FBV, lÃ­nea 951)
   [NO_MIXIN]
   MOTIVO: Solo @login_required sin VerificarPermisoMixin. Otorga acceso sin permiso granular auditado.
   RIESGO: ALTO - operaciÃ³n crÃ­tica sin permisos granulares
   PROPUESTA: Agregar @verificar_permiso('Access Control - Otorgar Acceso', 'autorizar')

OBSERVACIÃ“N GENERAL access_control: Es el app de administraciÃ³n de permisos. Las 3 vistas core (Crear/Editar/Eliminar Permiso) deberÃ­an tener VerificarPermisoMixin. El mixin local aquÃ­ es la versiÃ³n OFICIAL, debe permanecer.



APP: settings
ESTADO: 7 INCUMPLIMIENTOS (Riesgo variable)

âœ… CUMPLEN ESTÃNDAR: ninguna (internals, pero sin mixin oficial)

âŒ NO CUMPLEN ESTÃNDAR:

1. probar_configuracion_entrada (FBV, lÃ­nea 24)
   [NO_MIXIN] [NO_LOGIN_GUARD]
   MOTIVO: @csrf_exempt @require_POST sin @login_required ni VerificarPermisoMixin. Endpoint AJAX de prueba sin seguridad.
   RIESGO: CRÃTICO - endpoint pÃºblicamente accesible que prueba configuraciÃ³n de entrada de email
   PROPUESTA: Agregar @login_required + @verificar_permiso('Settings - Probar Config Entrada', 'modificar')

2. probar_configuracion_salida (FBV, lÃ­nea 56)
   [NO_MIXIN] [NO_LOGIN_GUARD]
   MOTIVO: @csrf_exempt @require_POST sin @login_required. Endpoint de prueba sin seguridad.
   RIESGO: CRÃTICO - pÃºblicamente accesible, podrÃ­a abusarse para envÃ­os masivos
   PROPUESTA: Agregar @login_required + @verificar_permiso('Settings - Probar Config Salida', 'modificar')

3. enviar_correo_prueba (FBV, lÃ­nea 87)
   [NO_MIXIN]
   MOTIVO: @csrf_exempt @require_POST @login_required sin VerificarPermisoMixin. EnvÃ­a email sin permiso granular.
   RIESGO: ALTO - cualquier usuario autenticado puede enviar emails de prueba (abuso potencial)
   PROPUESTA: Agregar @verificar_permiso('Settings - Enviar Correo Prueba', 'crear')

4. recibir_correo_prueba (FBV, lÃ­nea 152)
   [NO_MIXIN]
   MOTIVO: @login_required sin VerificarPermisoMixin. Recibe email sin permiso granular.
   RIESGO: ALTO - cualquier usuario puede recibir correos de prueba
   PROPUESTA: Agregar @verificar_permiso('Settings - Recibir Correo Prueba', 'modificar')

5. set_fecha_sistema (FBV, lÃ­nea 189)
   [NO_MIXIN]
   MOTIVO: @login_required @require_POST sin VerificarPermisoMixin. Cambia fecha del sistema sin permisos granulares.
   RIESGO: CRÃTICO - operaciÃ³n crÃ­tica que afecta timestamps globales
   PROPUESTA: Agregar @verificar_permiso('Settings - Set Fecha Sistema', 'autorizar')

6. configurar_email (FBV, lÃ­nea 228)
   [NO_MIXIN]
   MOTIVO: @login_required sin VerificarPermisoMixin. Configura email sin permisos granulares.
   RIESGO: ALTO - cambios en configuraciÃ³n global sin auditabilidad
   PROPUESTA: Agregar @verificar_permiso('Settings - Configurar Email', 'modificar')

7. guardar_preferencias (FBV, lÃ­nea 244)
   [NO_MIXIN]
   MOTIVO: @require_POST @login_required @verificar_permiso(...) - FBV decorator sin CBV. Inconsistente con patrÃ³n.
   RIESGO: Bajo (funcional pero inconsistente)
   PROPUESTA: Convertir a CBV con VerificarPermisoMixin para consistencia.

OBSERVACIÃ“N GENERAL settings: App crÃ­tica para configuraciÃ³n. TODAS las vistas necesitan @verificar_permiso o conversiÃ³n a CBV.



APP: core_search
ESTADO: 1 INCUMPLIMIENTO (Riesgo bajo)

âœ… CUMPLEN ESTÃNDAR: ninguna

âŒ NO CUMPLEN ESTÃNDAR:

1. menu_search (FBV, lÃ­nea 8)
   [NO_MIXIN]
   MOTIVO: @login_required sin VerificarPermisoMixin. BÃºsqueda de menÃº sin permisos granulares.
   RIESGO: Bajo (bÃºsqueda de navegaciÃ³n, tÃ­picamente sin restricciÃ³n)
   PROPUESTA: Sin cambio si es bÃºsqueda pÃºblica. O agregar @verificar_permiso('Core Search - BÃºsqueda MenÃº', 'ingresar')

OBSERVACIÃ“N GENERAL core_search: App pequeÃ±a, solo 1 FBV. Bajo impacto.



APP: evaluaciones
ESTADO: 2 INCUMPLIMIENTOS (Riesgo bajo)

âœ… CUMPLEN ESTÃNDAR: ninguna

âŒ NO CUMPLEN ESTÃNDAR:

1. VerificarPermisoMixin (CBV, lÃ­nea 5-20)
   [LOCAL_MIXIN]
   MOTIVO: Define su propio mixin local. DeberÃ­a importar la versiÃ³n oficial.
   RIESGO: Bajo (duplicaciÃ³n, pero funciona)
   PROPUESTA: Remover mixin local. Agregar import:
      from access_control.views import VerificarPermisoMixin

2. ImportarPersonasView (CBV, lÃ­nea 25)
   [BAD_VISTA_NOMBRE]
   MOTIVO: vista_nombre="Importar Personas" sin prefijo app. DeberÃ­a ser "Evaluaciones - Importar Personas"
   RIESGO: Bajo (naming inconsistency)
   PROPUESTA: Cambiar vista_nombre a "Evaluaciones - Importar Personas"

OBSERVACIÃ“N GENERAL evaluaciones: App pequeÃ±a, 1 vista. Necesita remover mixin local y estandarizar Vista.nombre.



APP: control_de_proyectos
ESTADO: 2 INCUMPLIMIENTOS (Riesgo ALTO - multiempresa)

âœ… CUMPLEN ESTÃNDAR (naming + mixin):
ListarProyectosView, DetalleProyectoView, CrearProyectoView, EditarProyectoView, EliminarProyectoView
CrearTareaView, EditarTareaView, EliminarTareaView, CrearClienteView, EditarClienteView
CrearProfesionalView, EditarProfesionalView, sugerir_tipos_proyecto, sugerir_especialidades
CrearTipoTareaView, SubirDocumentoTareaView, ActualizarAvanceTareaView

âŒ NO CUMPLEN ESTÃNDAR (Empresa scoping crÃ­tico):

1. ListarClientesView (CBV, lÃ­nea 328)
   [NO_EMPRESA_ACTIVA]
   MOTIVO: get_queryset() retorna ClienteEmpresa.objects.filter(activo=True) - NO filtra por empresa_id activa en sesiÃ³n
   RIESGO: CRÃTICO (multiempresa) - usuarios de Empresa A ven clientes de Empresa B
   PROPUESTA: Cambiar get_queryset():
      def get_queryset(self):
          empresa_id = self.request.session.get('empresa_id')
          return ClienteEmpresa.objects.filter(activo=True, empresa_id=empresa_id)

2. ListarProfesionalesView (CBV, lÃ­nea 387)
   [NO_EMPRESA_ACTIVA]
   MOTIVO: get_queryset() retorna Profesional.objects.filter(activo=True)... - NO filtra por empresa_id
   RIESGO: CRÃTICO (multiempresa) - usuarios ven profesionales de otras empresas
   PROPUESTA: Cambiar get_queryset():
      def get_queryset(self):
          empresa_id = self.request.session.get('empresa_id')
          return Profesional.objects.filter(activo=True, empresa_id=empresa_id).select_related(...)

OBSERVACIÃ“N GENERAL control_de_proyectos: La mayorÃ­a de vistas CUMPLE (buenas vistas de ejemplo).
Pero los 2 listados de maestros (clientes, profesionales) SÃ tienen datos globales sin scoping.
CRÃTICO para multiempresa.



APP: control_operacional
ESTADO: 0 INCUMPLIMIENTOS âœ… (CUMPLE COMPLETAMENTE)

âœ… CUMPLEN ESTÃNDAR:
DashboardView, AlertasOperacionalesView, AckAlertaView

OBSERVACIÃ“N: MigraciÃ³n reciente exitosa a CBV + VerificarPermisoMixin. Modelo a seguir.
Valida empresa_id en dispatch(), filtra alertas por empresa_id.
Vista.nombre descriptivo con prefijo "Control Operacional - ".
AJAX endpoint (AckAlertaView) retorna JsonResponse correctamente.



APP: notificaciones
ESTADO: 0 INCUMPLIMIENTOS âœ… (CUMPLE COMPLETAMENTE)

âœ… CUMPLEN ESTÃNDAR:
NotificacionesTopbarView, NotificacionesMarkReadView, NotificacionesMarkAllReadView, MisNotificacionesView
VerNotificacionView, CentroAlertasView, ForzarNotificacionesView, AlertaPersonalizadaView

OBSERVACIÃ“N: Todas las vistas usan VerificarPermisoMixin con vista_nombre descriptivo.
Validan empresa_id en casos necesarios. PatrÃ³n consistente y correcto.
MODELO A SEGUIR.



â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN FINAL - AUDITORÃA GLOBAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADÃSTICAS:
- Total apps auditados: 11
- Total vistas/endpoints revisados: ~120+
- Apps que CUMPLEN completamente (0 incumplimientos): 3 (chat, control_operacional, notificaciones)
- Apps con algÃºn incumplimiento: 8
- Total incumplimientos identificados: 47

DESGLOSE POR RIESGO:

ğŸ”´ ALTO RIESGO (12 incumplimientos):
1. respaldo_biblioteca_zip [NO_MIXIN] - descarga ZIP sin validar permisos
2. descargar_documentos_propiedad_zip [NO_MIXIN] - descarga ZIP de documentos sin control granular
3. enviar_enlace_documento [NO_MIXIN] - envÃ­a enlaces sin permisos granulares
4. TrabajadoresViewSet [NO_MIXIN] [NO_LOGIN_GUARD] - endpoint PÃšBLICO que expone rut/nombre de trabajadores
5. MaestroempresasMRO [NO_MIXIN] [NO_LOGIN_GUARD] - endpoint PÃšBLICO que expone datos maestros
6. invite_user (api) [NO_MIXIN] [NO_LOGIN_GUARD] - invitar usuarios sin autenticaciÃ³n
7. toggle_permiso [NO_MIXIN] [NO_LOGIN_GUARD] - toggle de permisos sin estar autenticado
8. grant_access_request [NO_MIXIN] - otorga acceso sin permisos granulares editables
9. probar_configuracion_entrada [NO_MIXIN] [NO_LOGIN_GUARD] - endpoint PÃšBLICO
10. probar_configuracion_salida [NO_MIXIN] [NO_LOGIN_GUARD] - endpoint PÃšBLICO
11. set_fecha_sistema [NO_MIXIN] - cambios crÃ­ticos en sistema sin permisos granulares
12. ListarClientesView [NO_EMPRESA_ACTIVA] - CRÃTICO multiempresa: datos globales sin scoping
13. ListarProfesionalesView [NO_EMPRESA_ACTIVA] - CRÃTICO multiempresa: datos globales sin scoping

ğŸŸ  RIESGO MEDIO (15 incumplimientos):
- enviar_correo_prueba, recibir_correo_prueba, configurar_email, set_fecha_sistema (settings)
- PermisoCrearView, PermisoEditarView, PermisoEliminarView, solicitar_acceso (access_control)
- crear_usuario_admin, editar_perfil, subeAvatar, cambiar_password (acounts)

ğŸŸ¡ RIESGO BAJO (20 incumplimientos):
- LOCAL_MIXIN en biblioteca, evaluaciones (duplicaciÃ³n innecesaria)
- BAD_VISTA_NOMBRE en mÃºltiples vistas (naming inconsistency, sin prefijo app)
- ModalesEjemploView (ejemplo, no prod)
- menu_search, core_search (bÃºsqueda de navegaciÃ³n)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TOP 3 APPS CON MÃS INCUMPLIMIENTOS:

1. settings (7 incumplimientos - ALTO RIESGO)
   App crÃ­tica. TODAS las vistas necesitan @verificar_permiso.
   Endpoints de prueba (probar_config_*) expuestos pÃºblicamente.
   SIN CAMBIAR, expone configuraciÃ³n crÃ­tica.

2. biblioteca (8 incumplimientos)
   Mixin local que debe removerse.
   FBVs de descarga/envÃ­o sin permisos granulares.
   Vista.nombre inconsistentes (faltan prefijo "Biblioteca - ").

3. api (3 incumplimientos - CRÃTICO)
   ViewSets sin autenticaciÃ³n (@permission_classes ausente).
   Endpoints PÃšBLICOS que exponen datos sensibles (rut, nombres).
   invite_user sin @login_required.
   RIESGO MÃS ALTO DEL PROYECTO.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LISTA PRIORIZADA DE CORRECCIONES (Orden de urgencia):

PRIORIDAD 1 - CRÃTICO (Corregir INMEDIATAMENTE):
1. api/views.py
   - Agregar permission_classes = [IsAuthenticated] a TrabajadoresViewSet
   - Agregar permission_classes = [IsAuthenticated] a MaestroempresasMRO
   - Agregar @login_required a invite_user (FBV)

2. control_de_proyectos/views.py
   - Agregar empresa_id filtering en ListarClientesView.get_queryset()
   - Agregar empresa_id filtering en ListarProfesionalesView.get_queryset()

3. settings/views.py
   - Agregar @login_required a probar_configuracion_entrada y probar_configuracion_salida
   - Agregar @verificar_permiso a set_fecha_sistema (operaciÃ³n crÃ­tica)

PRIORIDAD 2 - ALTO RIESGO (Corregir en prÃ³ximo sprint):
1. biblioteca/views.py
   - Remover VerificarPermisoMixin local, importar oficial
   - Agregar @verificar_permiso a respaldo_biblioteca_zip, descargar_documentos_propiedad_zip, enviar_enlace_documento
   - Estandarizar Vista.nombre con prefijo "Biblioteca - "

2. access_control/views.py
   - Agregar VerificarPermisoMixin a PermisoCrearView, PermisoEditarView, PermisoEliminarView
   - Agregar @verificar_permiso a toggle_permiso, grant_access_request

PRIORIDAD 3 - RIESGO MEDIO (Corregir en sprint future):
1. settings/views.py
   - Agregar @verificar_permiso a enviarcorreo_prueba, recibir_correo_prueba, configurar_email
   - Convertir guardar_preferencias a CBV para consistencia

2. acounts/views.py
   - Agregar @verificar_permiso a crear_usuario_admin, editar_perfil, subeAvatar, cambiar_password

3. biblioteca/views.py
   - Estandarizar todos los Vista.nombre

PRIORIDAD 4 - BAJO RIESGO (Corregir cuando haya tiempo):
1. evaluaciones/views.py
   - Remover VerificarPermisoMixin local
   - Estandarizar Vista.nombre

2. core_search/views.py
   - Agregar @verificar_permiso si es necesario

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INCUMPLIMIENTOS POR TAG (AnÃ¡lisis):

[NO_MIXIN] - 33 incumplimientos
  Vistas sin VerificarPermisoMixin ni @verificar_permiso.
  Afecta: biblioteca (5), acounts (4), access_control (3), settings (7), api (3), core_search (1), evaluaciones (2), etc.
  IMPACTO: PÃ©rdida de auditabilidad de permisos.

[NO_LOGIN_GUARD] - 8 incumplimientos
  Vistas sin @login_required ni LoginRequiredMixin.
  Afecta: acounts (3), settings (2), api (3)
  IMPACTO: Acceso pÃºblico a endpoints que podrÃ­an ser sensibles.

[NO_EMPRESA_ACTIVA] - 2 incumplimientos
  Vistas que no filtran por empresa_id.
  Afecta: control_de_proyectos (2)
  IMPACTO: CRÃTICO en multiempresa - data leaks entre empresas.

[BAD_VISTA_NOMBRE] - 7 incumplimientos
  Vista.nombre sin prefijo app.
  Afecta: biblioteca (3+), evaluaciones (1)
  IMPACTO: Naming inconsistency, pero funcional.

[BAD_PERMISO] - 0 incumplimientos
  (access_control VistaEditarView usa "editar" en lugar de "modificar", pero es internal admin)

[LOCAL_MIXIN] - 3 incumplimientos
  Apps con su propio VerificarPermisoMixin en lugar de importar el oficial.
  Afecta: biblioteca (1), evaluaciones (1), access_control (1 - pero este ES el oficial)
  IMPACTO: DuplicaciÃ³n innecesaria en biblioteca evaluaciones.

[AJAX_BAD] - 0 incumplimientos
  Todos los endpoints AJAX retornan JsonResponse correctamente.

[DELETE_PATTERN] - No auditado en este paso
  Patrones de eliminaciÃ³n con modal + AJAX.
  RequerirÃ¡ auditorÃ­a adicional de templates.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MODELOS A SEGUIR (GOOD EXAMPLES):

âœ… APP: notificaciones
   - Todas las vistas usan VerificarPermisoMixin
   - Vista.nombre estandarizado con prefijo "Notificaciones - "
   - ValidaciÃ³n de empresa_id donde corresponde
   - Endpoints AJAX retornan JsonResponse correctamente

âœ… APP: control_operacional
   - CBVs con VerificarPermisoMixin
   - Vista.nombre='Control Operacional - <acciÃ³n>'
   - ValidaciÃ³n de empresa_id en dispatch()
   - Endpoint AJAX correcto

âœ… APP: chat
   - CBVs consistentes con VerificarPermisoMixin
   - Vista.nombre con prefijo "Chat - "
   - Permisos granulares correctos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RECOMENDACIONES GENERALES:

1. INMEDIATO:
   - Proteger endpoints pÃºblicos en api/ con @login_required o permission_classes
   - Arreglar empresa_id scoping en control_de_proyectos ListarClientes/Profesionales
   - Proteger endpoints de settings que son actualmente pÃºblicos

2. CORTO PLAZO (prÃ³ximo sprint):
   - Removerl VerificarPermisoMixin local en biblioteca, evaluaciones
   - Estandarizar Vista.nombre con prefijo app en todas las vistas
   - Agregar @verificar_permiso a FBVs crÃ­ticas

3. MEDIANO PLAZO:
   - Convertir FBVs administrativas a CBVs con VerificarPermisoMixin
   - Auditar eliminaciÃ³n de documentos/registros (AJAX_DELETION_PATTERN)
   - Validar empresa_id en todas las vistas scoped

4. DOCUMENTACIÃ“N:
   - Crear archivo STANDARDS_VIEWS.md con patrones recomendados
   - Documentar que acceso_control.views.VerificarPermisoMixin es la versiÃ³n oficial
   - Incluir checklist para nuevas vistas

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FIN DE AUDITORÃA
